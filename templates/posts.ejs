<!-- Page Header -->
<header class="page-header">
  <h1 class="page-title">æ‰€æœ‰æ–‡ç« </h1>
  <p class="page-description">æ¢ç´¢æˆ‘ä»¬çš„æ–‡ç« é›†åˆï¼Œå‘ç°æœ‰è¶£çš„å†…å®¹</p>
</header>

<!-- Posts Filter -->
<div class="posts-filter">
  <div class="filter-controls">
    <div class="search-box">
      <input type="text" id="search-input" placeholder="æœç´¢æ–‡ç« ..." class="search-input">
      <button type="button" class="search-btn">ğŸ”</button>
    </div>
    
    <div class="filter-options">
      <select id="category-filter" class="filter-select">
        <option value="">æ‰€æœ‰åˆ†ç±»</option>
        <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
      </select>
      
      <select id="sort-filter" class="filter-select">
        <option value="date-desc">æœ€æ–°å‘å¸ƒ</option>
        <option value="date-asc">æœ€æ—©å‘å¸ƒ</option>
        <option value="title">æ ‡é¢˜æ’åº</option>
      </select>
    </div>
  </div>
</div>

<!-- Posts Grid -->
<% if (posts && posts.length > 0) { %>
<div class="posts-container">
  <div class="posts-stats">
    <p class="posts-count">å…± <span id="posts-total"><%= posts.length %></span> ç¯‡æ–‡ç« </p>
  </div>
  
  <div class="posts-grid" id="posts-grid">
    <% posts.forEach(function(post, index) { %>
    <article class="post-card" data-category="<%= post.category || '' %>" data-date="<%= new Date(post.date).getTime() %>" data-title="<%= post.title.toLowerCase() %>">
      <div class="post-meta">
        <time class="post-date" datetime="<%= new Date(post.date).toISOString() %>">
          <%= new Date(post.date).toLocaleDateString('zh-CN') %>
        </time>
        <% if (post.category) { %>
        <span class="post-category"><%= post.category %></span>
        <% } %>
      </div>
      
      <h2 class="post-title">
        <a href="<%= post.url %>"><%= post.title %></a>
      </h2>
      
      <% if (post.excerpt) { %>
      <p class="post-excerpt"><%= post.excerpt %></p>
      <% } %>
      
      <% if (post.tags && post.tags.length > 0) { %>
      <div class="post-tags">
        <% post.tags.forEach(function(tag) { %>
        <a href="/tags/<%= tag.toLowerCase().replace(/\s+/g, '-') %>/" class="tag">#<%= tag %></a>
        <% }); %>
      </div>
      <% } %>
      
      <div class="post-actions">
        <a href="<%= post.url %>" class="read-more">é˜…è¯»æ›´å¤š</a>
        <% if (post.readingTime) { %>
        <span class="reading-time"><%= post.readingTime %> åˆ†é’Ÿé˜…è¯»</span>
        <% } %>
      </div>
    </article>
    <% }); %>
  </div>
  
  <!-- Pagination -->
  <div class="pagination" id="pagination">
    <!-- åˆ†é¡µå°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
  </div>
</div>
<% } else { %>
<div class="empty-state">
  <div class="empty-icon">ğŸ“</div>
  <h3>æš‚æ— æ–‡ç« </h3>
  <p>è¿˜æ²¡æœ‰å‘å¸ƒä»»ä½•æ–‡ç« ï¼Œè¯·ç¨åå†æ¥æŸ¥çœ‹ã€‚</p>
</div>
<% } %>

<!-- Posts Archive by Year -->
<% if (posts && posts.length > 0) { %>
<section class="posts-archive">
  <h2 class="section-title">æ–‡ç« å½’æ¡£</h2>
  
  <div class="archive-timeline">
    <% 
    const postsByYear = {};
    posts.forEach(function(post) {
      const year = new Date(post.date).getFullYear();
      if (!postsByYear[year]) {
        postsByYear[year] = [];
      }
      postsByYear[year].push(post);
    });
    
    Object.keys(postsByYear).sort((a, b) => b - a).forEach(function(year) {
    %>
    <div class="archive-year">
      <h3 class="year-title"><%= year %> å¹´ (<%= postsByYear[year].length %> ç¯‡)</h3>
      <div class="year-posts">
        <% postsByYear[year].forEach(function(post) { %>
        <div class="archive-post">
          <time class="archive-date"><%= new Date(post.date).toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }) %></time>
          <a href="<%= post.url %>" class="archive-title"><%= post.title %></a>
        </div>
        <% }); %>
      </div>
    </div>
    <% }); %>
  </div>
</section>
<% } %>

<script>
// æ–‡ç« è¿‡æ»¤å’Œæœç´¢åŠŸèƒ½
(function() {
  const searchInput = document.getElementById('search-input');
  const categoryFilter = document.getElementById('category-filter');
  const sortFilter = document.getElementById('sort-filter');
  const postsGrid = document.getElementById('posts-grid');
  const postsTotal = document.getElementById('posts-total');
  
  let allPosts = Array.from(document.querySelectorAll('.post-card'));
  let filteredPosts = [...allPosts];
  
  // åˆå§‹åŒ–åˆ†ç±»é€‰é¡¹
  function initCategoryFilter() {
    const categories = new Set();
    allPosts.forEach(post => {
      const category = post.dataset.category;
      if (category) categories.add(category);
    });
    
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      categoryFilter.appendChild(option);
    });
  }
  
  // è¿‡æ»¤æ–‡ç« 
  function filterPosts() {
    const searchTerm = searchInput.value.toLowerCase();
    const selectedCategory = categoryFilter.value;
    
    filteredPosts = allPosts.filter(post => {
      const title = post.dataset.title;
      const category = post.dataset.category;
      
      const matchesSearch = !searchTerm || title.includes(searchTerm);
      const matchesCategory = !selectedCategory || category === selectedCategory;
      
      return matchesSearch && matchesCategory;
    });
    
    sortPosts();
    displayPosts();
  }
  
  // æ’åºæ–‡ç« 
  function sortPosts() {
    const sortBy = sortFilter.value;
    
    filteredPosts.sort((a, b) => {
      switch (sortBy) {
        case 'date-desc':
          return parseInt(b.dataset.date) - parseInt(a.dataset.date);
        case 'date-asc':
          return parseInt(a.dataset.date) - parseInt(b.dataset.date);
        case 'title':
          return a.dataset.title.localeCompare(b.dataset.title);
        default:
          return 0;
      }
    });
  }
  
  // æ˜¾ç¤ºæ–‡ç« 
  function displayPosts() {
    // éšè—æ‰€æœ‰æ–‡ç« 
    allPosts.forEach(post => {
      post.style.display = 'none';
    });
    
    // æ˜¾ç¤ºè¿‡æ»¤åçš„æ–‡ç« 
    filteredPosts.forEach(post => {
      post.style.display = 'block';
    });
    
    // æ›´æ–°æ–‡ç« æ•°é‡
    postsTotal.textContent = filteredPosts.length;
  }
  
  // äº‹ä»¶ç›‘å¬
  searchInput.addEventListener('input', filterPosts);
  categoryFilter.addEventListener('change', filterPosts);
  sortFilter.addEventListener('change', filterPosts);
  
  // åˆå§‹åŒ–
  initCategoryFilter();
})();
</script>