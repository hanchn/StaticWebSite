<!-- Settings Header -->
<div class="admin-header">
    <div class="header-left">
        <h1 class="admin-title">
            <i class="fas fa-cog"></i>
            网站设置
        </h1>
        <p class="admin-subtitle">
            配置您的博客网站基本信息和功能选项
        </p>
    </div>
    <div class="header-right">
        <button class="btn btn-primary" id="saveSettings">
            <i class="fas fa-save"></i>
            保存设置
        </button>
        <button class="btn btn-outline" id="resetSettings">
            <i class="fas fa-undo"></i>
            重置
        </button>
    </div>
</div>

<!-- Settings Navigation -->
<div class="settings-nav">
    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="general">
            <i class="fas fa-globe"></i>
            基本设置
        </button>
        <button class="nav-tab" data-tab="appearance">
            <i class="fas fa-palette"></i>
            外观设置
        </button>
        <button class="nav-tab" data-tab="seo">
            <i class="fas fa-search"></i>
            SEO 设置
        </button>
        <button class="nav-tab" data-tab="social">
            <i class="fas fa-share-alt"></i>
            社交媒体
        </button>
        <button class="nav-tab" data-tab="comments">
            <i class="fas fa-comments"></i>
            评论设置
        </button>
        <button class="nav-tab" data-tab="analytics">
            <i class="fas fa-chart-line"></i>
            统计分析
        </button>
        <button class="nav-tab" data-tab="advanced">
            <i class="fas fa-code"></i>
            高级设置
        </button>
    </nav>
</div>

<!-- Settings Content -->
<form id="settingsForm" class="settings-form">
    <!-- General Settings -->
    <div class="settings-panel active" data-panel="general">
        <div class="panel-header">
            <h2>基本设置</h2>
            <p>配置网站的基本信息</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>网站信息</h3>
                
                <div class="form-group">
                    <label for="siteTitle" class="form-label required">网站标题</label>
                    <input type="text" id="siteTitle" name="site.title" class="form-input" 
                           value="<%= config.site?.title || '' %>" 
                           placeholder="我的博客" required>
                    <div class="form-help">显示在浏览器标题栏和搜索结果中</div>
                </div>
                
                <div class="form-group">
                    <label for="siteSubtitle" class="form-label">网站副标题</label>
                    <input type="text" id="siteSubtitle" name="site.subtitle" class="form-input" 
                           value="<%= config.site?.subtitle || '' %>" 
                           placeholder="分享技术与生活">
                    <div class="form-help">显示在网站标题下方</div>
                </div>
                
                <div class="form-group">
                    <label for="siteDescription" class="form-label required">网站描述</label>
                    <textarea id="siteDescription" name="site.description" class="form-textarea" rows="3" 
                              placeholder="这是一个关于技术和生活的博客..." required><%= config.site?.description || '' %></textarea>
                    <div class="form-help">用于 SEO 和社交媒体分享</div>
                </div>
                
                <div class="form-group">
                    <label for="siteUrl" class="form-label required">网站地址</label>
                    <input type="url" id="siteUrl" name="site.url" class="form-input" 
                           value="<%= config.site?.url || '' %>" 
                           placeholder="https://example.com" required>
                    <div class="form-help">网站的完整 URL 地址</div>
                </div>
                
                <div class="form-group">
                    <label for="siteLogo" class="form-label">网站 Logo</label>
                    <div class="file-input-group">
                        <input type="text" id="siteLogo" name="site.logo" class="form-input" 
                               value="<%= config.site?.logo || '' %>" 
                               placeholder="/images/logo.png">
                        <button type="button" class="btn btn-outline" id="selectLogo">
                            <i class="fas fa-image"></i>
                            选择
                        </button>
                    </div>
                    <div class="logo-preview" id="logoPreview">
                        <% if (config.site?.logo) { %>
                        <img src="<%= config.site.logo %>" alt="Logo" class="preview-image">
                        <% } %>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="siteFavicon" class="form-label">网站图标 (Favicon)</label>
                    <div class="file-input-group">
                        <input type="text" id="siteFavicon" name="site.favicon" class="form-input" 
                               value="<%= config.site?.favicon || '' %>" 
                               placeholder="/images/favicon.ico">
                        <button type="button" class="btn btn-outline" id="selectFavicon">
                            <i class="fas fa-image"></i>
                            选择
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>作者信息</h3>
                
                <div class="form-group">
                    <label for="authorName" class="form-label required">作者姓名</label>
                    <input type="text" id="authorName" name="author.name" class="form-input" 
                           value="<%= config.author?.name || '' %>" 
                           placeholder="张三" required>
                </div>
                
                <div class="form-group">
                    <label for="authorEmail" class="form-label">作者邮箱</label>
                    <input type="email" id="authorEmail" name="author.email" class="form-input" 
                           value="<%= config.author?.email || '' %>" 
                           placeholder="author@example.com">
                </div>
                
                <div class="form-group">
                    <label for="authorBio" class="form-label">作者简介</label>
                    <textarea id="authorBio" name="author.bio" class="form-textarea" rows="3" 
                              placeholder="简单介绍一下自己..."><%= config.author?.bio || '' %></textarea>
                </div>
                
                <div class="form-group">
                    <label for="authorAvatar" class="form-label">作者头像</label>
                    <div class="file-input-group">
                        <input type="text" id="authorAvatar" name="author.avatar" class="form-input" 
                               value="<%= config.author?.avatar || '' %>" 
                               placeholder="/images/avatar.jpg">
                        <button type="button" class="btn btn-outline" id="selectAvatar">
                            <i class="fas fa-image"></i>
                            选择
                        </button>
                    </div>
                    <div class="avatar-preview" id="avatarPreview">
                        <% if (config.author?.avatar) { %>
                        <img src="<%= config.author.avatar %>" alt="Avatar" class="preview-avatar">
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Appearance Settings -->
    <div class="settings-panel" data-panel="appearance">
        <div class="panel-header">
            <h2>外观设置</h2>
            <p>自定义网站的外观和主题</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>主题设置</h3>
                
                <div class="form-group">
                    <label for="theme" class="form-label">主题</label>
                    <select id="theme" name="appearance.theme" class="form-select">
                        <option value="default" <%= config.appearance?.theme === 'default' ? 'selected' : '' %>>默认主题</option>
                        <option value="dark" <%= config.appearance?.theme === 'dark' ? 'selected' : '' %>>深色主题</option>
                        <option value="minimal" <%= config.appearance?.theme === 'minimal' ? 'selected' : '' %>>简约主题</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="primaryColor" class="form-label">主色调</label>
                    <div class="color-input-group">
                        <input type="color" id="primaryColor" name="appearance.primaryColor" 
                               value="<%= config.appearance?.primaryColor || '#007bff' %>" class="color-input">
                        <input type="text" class="form-input" 
                               value="<%= config.appearance?.primaryColor || '#007bff' %>" 
                               placeholder="#007bff">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="accentColor" class="form-label">强调色</label>
                    <div class="color-input-group">
                        <input type="color" id="accentColor" name="appearance.accentColor" 
                               value="<%= config.appearance?.accentColor || '#28a745' %>" class="color-input">
                        <input type="text" class="form-input" 
                               value="<%= config.appearance?.accentColor || '#28a745' %>" 
                               placeholder="#28a745">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="customCSS" class="form-label">自定义 CSS</label>
                    <textarea id="customCSS" name="appearance.customCSS" class="form-textarea code-textarea" rows="8" 
                              placeholder="/* 在这里添加自定义 CSS */"><%= config.appearance?.customCSS || '' %></textarea>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>布局设置</h3>
                
                <div class="form-group">
                    <label for="postsPerPage" class="form-label">每页文章数</label>
                    <input type="number" id="postsPerPage" name="appearance.postsPerPage" class="form-input" 
                           value="<%= config.appearance?.postsPerPage || 10 %>" 
                           min="1" max="50">
                </div>
                
                <div class="form-group">
                    <label for="excerptLength" class="form-label">摘要长度</label>
                    <input type="number" id="excerptLength" name="appearance.excerptLength" class="form-input" 
                           value="<%= config.appearance?.excerptLength || 200 %>" 
                           min="50" max="500">
                    <div class="form-help">文章摘要的字符数</div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="appearance.showReadingTime" 
                               <%= config.appearance?.showReadingTime !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        显示阅读时间
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="appearance.showViewCount" 
                               <%= config.appearance?.showViewCount !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        显示浏览次数
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="appearance.showTOC" 
                               <%= config.appearance?.showTOC !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        显示文章目录
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- SEO Settings -->
    <div class="settings-panel" data-panel="seo">
        <div class="panel-header">
            <h2>SEO 设置</h2>
            <p>优化搜索引擎排名</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>基本 SEO</h3>
                
                <div class="form-group">
                    <label for="seoKeywords" class="form-label">网站关键词</label>
                    <input type="text" id="seoKeywords" name="seo.keywords" class="form-input" 
                           value="<%= config.seo?.keywords || '' %>" 
                           placeholder="博客, 技术, 生活, 分享">
                    <div class="form-help">用逗号分隔多个关键词</div>
                </div>
                
                <div class="form-group">
                    <label for="seoRobots" class="form-label">Robots 设置</label>
                    <select id="seoRobots" name="seo.robots" class="form-select">
                        <option value="index,follow" <%= config.seo?.robots === 'index,follow' ? 'selected' : '' %>>允许索引和跟踪链接</option>
                        <option value="index,nofollow" <%= config.seo?.robots === 'index,nofollow' ? 'selected' : '' %>>允许索引，不跟踪链接</option>
                        <option value="noindex,follow" <%= config.seo?.robots === 'noindex,follow' ? 'selected' : '' %>>不索引，跟踪链接</option>
                        <option value="noindex,nofollow" <%= config.seo?.robots === 'noindex,nofollow' ? 'selected' : '' %>>不索引，不跟踪链接</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="seo.generateSitemap" 
                               <%= config.seo?.generateSitemap !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        生成站点地图 (sitemap.xml)
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="seo.generateRSS" 
                               <%= config.seo?.generateRSS !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        生成 RSS 订阅 (rss.xml)
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Open Graph</h3>
                
                <div class="form-group">
                    <label for="ogImage" class="form-label">默认分享图片</label>
                    <div class="file-input-group">
                        <input type="text" id="ogImage" name="seo.ogImage" class="form-input" 
                               value="<%= config.seo?.ogImage || '' %>" 
                               placeholder="/images/og-image.jpg">
                        <button type="button" class="btn btn-outline" id="selectOgImage">
                            <i class="fas fa-image"></i>
                            选择
                        </button>
                    </div>
                    <div class="form-help">推荐尺寸: 1200x630 像素</div>
                </div>
                
                <div class="form-group">
                    <label for="twitterCard" class="form-label">Twitter 卡片类型</label>
                    <select id="twitterCard" name="seo.twitterCard" class="form-select">
                        <option value="summary" <%= config.seo?.twitterCard === 'summary' ? 'selected' : '' %>>摘要</option>
                        <option value="summary_large_image" <%= config.seo?.twitterCard === 'summary_large_image' ? 'selected' : '' %>>大图摘要</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="twitterSite" class="form-label">Twitter 用户名</label>
                    <input type="text" id="twitterSite" name="seo.twitterSite" class="form-input" 
                           value="<%= config.seo?.twitterSite || '' %>" 
                           placeholder="@username">
                </div>
            </div>
        </div>
    </div>
    
    <!-- Social Media Settings -->
    <div class="settings-panel" data-panel="social">
        <div class="panel-header">
            <h2>社交媒体</h2>
            <p>配置社交媒体链接和分享功能</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>社交媒体链接</h3>
                
                <div class="form-group">
                    <label for="socialWeibo" class="form-label">微博</label>
                    <input type="url" id="socialWeibo" name="social.weibo" class="form-input" 
                           value="<%= config.social?.weibo || '' %>" 
                           placeholder="https://weibo.com/username">
                </div>
                
                <div class="form-group">
                    <label for="socialTwitter" class="form-label">Twitter</label>
                    <input type="url" id="socialTwitter" name="social.twitter" class="form-input" 
                           value="<%= config.social?.twitter || '' %>" 
                           placeholder="https://twitter.com/username">
                </div>
                
                <div class="form-group">
                    <label for="socialGithub" class="form-label">GitHub</label>
                    <input type="url" id="socialGithub" name="social.github" class="form-input" 
                           value="<%= config.social?.github || '' %>" 
                           placeholder="https://github.com/username">
                </div>
                
                <div class="form-group">
                    <label for="socialLinkedin" class="form-label">LinkedIn</label>
                    <input type="url" id="socialLinkedin" name="social.linkedin" class="form-input" 
                           value="<%= config.social?.linkedin || '' %>" 
                           placeholder="https://linkedin.com/in/username">
                </div>
                
                <div class="form-group">
                    <label for="socialEmail" class="form-label">邮箱</label>
                    <input type="email" id="socialEmail" name="social.email" class="form-input" 
                           value="<%= config.social?.email || '' %>" 
                           placeholder="contact@example.com">
                </div>
            </div>
            
            <div class="settings-section">
                <h3>分享设置</h3>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="social.enableShare" 
                               <%= config.social?.enableShare !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        启用文章分享功能
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="shareButtons" class="form-label">分享按钮</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="social.shareButtons.weibo" 
                                   <%= config.social?.shareButtons?.weibo !== false ? 'checked' : '' %>>
                            <span class="checkbox-custom"></span>
                            微博
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="social.shareButtons.qq" 
                                   <%= config.social?.shareButtons?.qq !== false ? 'checked' : '' %>>
                            <span class="checkbox-custom"></span>
                            QQ 空间
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="social.shareButtons.wechat" 
                                   <%= config.social?.shareButtons?.wechat !== false ? 'checked' : '' %>>
                            <span class="checkbox-custom"></span>
                            微信
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="social.shareButtons.twitter" 
                                   <%= config.social?.shareButtons?.twitter !== false ? 'checked' : '' %>>
                            <span class="checkbox-custom"></span>
                            Twitter
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="social.shareButtons.facebook" 
                                   <%= config.social?.shareButtons?.facebook !== false ? 'checked' : '' %>>
                            <span class="checkbox-custom"></span>
                            Facebook
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Comments Settings -->
    <div class="settings-panel" data-panel="comments">
        <div class="panel-header">
            <h2>评论设置</h2>
            <p>配置文章评论功能</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>评论系统</h3>
                
                <div class="form-group">
                    <label for="commentSystem" class="form-label">评论系统</label>
                    <select id="commentSystem" name="comments.system" class="form-select">
                        <option value="none" <%= config.comments?.system === 'none' ? 'selected' : '' %>>禁用评论</option>
                        <option value="disqus" <%= config.comments?.system === 'disqus' ? 'selected' : '' %>>Disqus</option>
                        <option value="gitalk" <%= config.comments?.system === 'gitalk' ? 'selected' : '' %>>Gitalk</option>
                        <option value="valine" <%= config.comments?.system === 'valine' ? 'selected' : '' %>>Valine</option>
                    </select>
                </div>
                
                <!-- Disqus Settings -->
                <div class="comment-config" id="disqusConfig" style="display: <% if (config.comments?.system === 'disqus') { %>block<% } else { %>none<% } %>">
                    <div class="form-group">
                        <label for="disqusShortname" class="form-label">Disqus Shortname</label>
                        <input type="text" id="disqusShortname" name="comments.disqus.shortname" class="form-input" 
                               value="<%= config.comments?.disqus?.shortname || '' %>" 
                               placeholder="your-site-shortname">
                    </div>
                </div>
                
                <!-- Gitalk Settings -->
                <div class="comment-config" id="gitalkConfig" style="display: <% if (config.comments?.system === 'gitalk') { %>block<% } else { %>none<% } %>">
                    <div class="form-group">
                        <label for="gitalkClientId" class="form-label">GitHub Client ID</label>
                        <input type="text" id="gitalkClientId" name="comments.gitalk.clientId" class="form-input" 
                               value="<%= config.comments?.gitalk?.clientId || '' %>" 
                               placeholder="GitHub OAuth App Client ID">
                    </div>
                    
                    <div class="form-group">
                        <label for="gitalkClientSecret" class="form-label">GitHub Client Secret</label>
                        <input type="password" id="gitalkClientSecret" name="comments.gitalk.clientSecret" class="form-input" 
                               value="<%= config.comments?.gitalk?.clientSecret || '' %>" 
                               placeholder="GitHub OAuth App Client Secret">
                    </div>
                    
                    <div class="form-group">
                        <label for="gitalkRepo" class="form-label">GitHub 仓库</label>
                        <input type="text" id="gitalkRepo" name="comments.gitalk.repo" class="form-input" 
                               value="<%= config.comments?.gitalk?.repo || '' %>" 
                               placeholder="repository-name">
                    </div>
                    
                    <div class="form-group">
                        <label for="gitalkOwner" class="form-label">GitHub 用户名</label>
                        <input type="text" id="gitalkOwner" name="comments.gitalk.owner" class="form-input" 
                               value="<%= config.comments?.gitalk?.owner || '' %>" 
                               placeholder="github-username">
                    </div>
                </div>
                
                <!-- Valine Settings -->
                <div class="comment-config" id="valineConfig" style="display: <% if (config.comments?.system === 'valine') { %>block<% } else { %>none<% } %>">
                    <div class="form-group">
                        <label for="valineAppId" class="form-label">LeanCloud App ID</label>
                        <input type="text" id="valineAppId" name="comments.valine.appId" class="form-input" 
                               value="<%= config.comments?.valine?.appId || '' %>" 
                               placeholder="LeanCloud App ID">
                    </div>
                    
                    <div class="form-group">
                        <label for="valineAppKey" class="form-label">LeanCloud App Key</label>
                        <input type="password" id="valineAppKey" name="comments.valine.appKey" class="form-input" 
                               value="<%= config.comments?.valine?.appKey || '' %>" 
                               placeholder="LeanCloud App Key">
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="comments.valine.visitor" 
                                   <%= config.comments?.valine?.visitor !== false ? 'checked' : '' %>>
                            <span class="checkbox-custom"></span>
                            启用访客统计
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>评论选项</h3>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="comments.defaultEnabled" 
                               <%= config.comments?.defaultEnabled !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        新文章默认开启评论
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="comments.requireModeration" 
                               <%= config.comments?.requireModeration ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        评论需要审核
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Analytics Settings -->
    <div class="settings-panel" data-panel="analytics">
        <div class="panel-header">
            <h2>统计分析</h2>
            <p>配置网站访问统计和分析工具</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>Google Analytics</h3>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="analytics.google.enabled" 
                               <%= config.analytics?.google?.enabled ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        启用 Google Analytics
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="googleTrackingId" class="form-label">跟踪 ID</label>
                    <input type="text" id="googleTrackingId" name="analytics.google.trackingId" class="form-input" 
                           value="<%= config.analytics?.google?.trackingId || '' %>" 
                           placeholder="G-XXXXXXXXXX 或 UA-XXXXXXXXX-X">
                </div>
            </div>
            
            <div class="settings-section">
                <h3>百度统计</h3>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="analytics.baidu.enabled" 
                               <%= config.analytics?.baidu?.enabled ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        启用百度统计
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="baiduTrackingId" class="form-label">统计代码</label>
                    <input type="text" id="baiduTrackingId" name="analytics.baidu.trackingId" class="form-input" 
                           value="<%= config.analytics?.baidu?.trackingId || '' %>" 
                           placeholder="百度统计代码">
                </div>
            </div>
            
            <div class="settings-section">
                <h3>其他统计</h3>
                
                <div class="form-group">
                    <label for="customAnalytics" class="form-label">自定义统计代码</label>
                    <textarea id="customAnalytics" name="analytics.custom" class="form-textarea code-textarea" rows="6" 
                              placeholder="<!-- 在这里添加自定义统计代码 -->"><%= config.analytics?.custom || '' %></textarea>
                    <div class="form-help">将在页面 &lt;head&gt; 标签中插入</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Advanced Settings -->
    <div class="settings-panel" data-panel="advanced">
        <div class="panel-header">
            <h2>高级设置</h2>
            <p>高级功能和开发者选项</p>
        </div>
        
        <div class="settings-grid">
            <div class="settings-section">
                <h3>构建设置</h3>
                
                <div class="form-group">
                    <label for="outputDir" class="form-label">输出目录</label>
                    <input type="text" id="outputDir" name="build.outputDir" class="form-input" 
                           value="<%= config.build?.outputDir || 'dist' %>" 
                           placeholder="dist">
                    <div class="form-help">静态文件生成目录</div>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="build.cleanOutput" 
                               <%= config.build?.cleanOutput !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        构建前清空输出目录
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="build.minifyHTML" 
                               <%= config.build?.minifyHTML ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        压缩 HTML
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="build.minifyCSS" 
                               <%= config.build?.minifyCSS ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        压缩 CSS
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="build.minifyJS" 
                               <%= config.build?.minifyJS ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        压缩 JavaScript
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>开发设置</h3>
                
                <div class="form-group">
                    <label for="devPort" class="form-label">开发服务器端口</label>
                    <input type="number" id="devPort" name="dev.port" class="form-input" 
                           value="<%= config.dev?.port || 3000 %>" 
                           min="1000" max="65535">
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="dev.liveReload" 
                               <%= config.dev?.liveReload !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        启用热重载
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="dev.openBrowser" 
                               <%= config.dev?.openBrowser !== false ? 'checked' : '' %>>
                        <span class="checkbox-custom"></span>
                        启动时自动打开浏览器
                    </label>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>自定义代码</h3>
                
                <div class="form-group">
                    <label for="customHead" class="form-label">自定义 Head 代码</label>
                    <textarea id="customHead" name="custom.head" class="form-textarea code-textarea" rows="6" 
                              placeholder="<!-- 在这里添加自定义 head 代码 -->"><%= config.custom?.head || '' %></textarea>
                    <div class="form-help">将在页面 &lt;head&gt; 标签末尾插入</div>
                </div>
                
                <div class="form-group">
                    <label for="customFooter" class="form-label">自定义 Footer 代码</label>
                    <textarea id="customFooter" name="custom.footer" class="form-textarea code-textarea" rows="6" 
                              placeholder="<!-- 在这里添加自定义 footer 代码 -->"><%= config.custom?.footer || '' %></textarea>
                    <div class="form-help">将在页面 &lt;/body&gt; 标签前插入</div>
                </div>
            </div>
        </div>
    </div>
</form>

<!-- Media Library Modal -->
<div id="mediaModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>选择图片</h3>
            <button type="button" class="modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="media-grid" id="mediaGrid">
                <div class="loading">加载中...</div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-outline" data-action="cancel">取消</button>
            <button type="button" class="btn btn-primary" data-action="select" disabled>选择</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 初始化设置页面
    initSettings();
    
    let currentTab = 'general';
    let selectedImage = null;
    let currentImageTarget = null;
    
    function initSettings() {
        bindEvents();
        initColorPickers();
        initCommentSystemToggle();
    }
    
    function bindEvents() {
        // 标签页切换
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });
        
        // 表单提交
        document.getElementById('saveSettings').addEventListener('click', saveSettings);
        document.getElementById('resetSettings').addEventListener('click', resetSettings);
        
        // 图片选择
        document.getElementById('selectLogo').addEventListener('click', () => openMediaLibrary('siteLogo'));
        document.getElementById('selectFavicon').addEventListener('click', () => openMediaLibrary('siteFavicon'));
        document.getElementById('selectAvatar').addEventListener('click', () => openMediaLibrary('authorAvatar'));
        document.getElementById('selectOgImage').addEventListener('click', () => openMediaLibrary('ogImage'));
        
        // 评论系统切换
        document.getElementById('commentSystem').addEventListener('change', toggleCommentConfig);
        
        // 模态框事件
        bindModalEvents();
    }
    
    function bindModalEvents() {
        const modal = document.getElementById('mediaModal');
        
        // 关闭模态框
        modal.querySelector('.modal-close').addEventListener('click', () => closeModal(modal));
        modal.querySelector('[data-action="cancel"]').addEventListener('click', () => closeModal(modal));
        modal.querySelector('[data-action="select"]').addEventListener('click', selectImage);
        
        // 点击背景关闭
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal(this);
            }
        });
    }
    
    function initColorPickers() {
        // 同步颜色选择器和文本输入框
        const colorInputs = document.querySelectorAll('.color-input-group');
        
        colorInputs.forEach(group => {
            const colorInput = group.querySelector('input[type="color"]');
            const textInput = group.querySelector('input[type="text"]');
            
            colorInput.addEventListener('change', function() {
                textInput.value = this.value;
            });
            
            textInput.addEventListener('input', function() {
                if (/^#[0-9A-F]{6}$/i.test(this.value)) {
                    colorInput.value = this.value;
                }
            });
        });
    }
    
    function initCommentSystemToggle() {
        toggleCommentConfig();
    }
    
    function switchTab(tabName) {
        currentTab = tabName;
        
        // 更新标签页状态
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.tab === tabName);
        });
        
        // 切换面板
        document.querySelectorAll('.settings-panel').forEach(panel => {
            panel.classList.toggle('active', panel.dataset.panel === tabName);
        });
    }
    
    function toggleCommentConfig() {
        const system = document.getElementById('commentSystem').value;
        const configs = document.querySelectorAll('.comment-config');
        
        configs.forEach(config => {
            config.style.display = 'none';
        });
        
        if (system !== 'none') {
            const targetConfig = document.getElementById(system + 'Config');
            if (targetConfig) {
                targetConfig.style.display = 'block';
            }
        }
    }
    
    async function saveSettings() {
        const form = document.getElementById('settingsForm');
        const formData = new FormData(form);
        
        // 转换为嵌套对象
        const settings = {};
        
        for (const [key, value] of formData.entries()) {
            setNestedValue(settings, key, value);
        }
        
        // 处理复选框
        const checkboxes = form.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            if (!formData.has(checkbox.name)) {
                setNestedValue(settings, checkbox.name, false);
            } else {
                setNestedValue(settings, checkbox.name, true);
            }
        });
        
        try {
            showLoading('正在保存设置...');
            
            const response = await fetch('/admin/api/settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(settings)
            });
            
            const result = await response.json();
            
            hideLoading();
            
            if (result.success) {
                showToast('设置保存成功', 'success');
            } else {
                showToast('保存失败: ' + result.message, 'error');
            }
        } catch (error) {
            hideLoading();
            showToast('保存失败', 'error');
            console.error('保存设置失败:', error);
        }
    }
    
    function resetSettings() {
        if (confirm('确定要重置所有设置吗？这将恢复到默认配置。')) {
            location.reload();
        }
    }
    
    function setNestedValue(obj, path, value) {
        const keys = path.split('.');
        let current = obj;
        
        for (let i = 0; i < keys.length - 1; i++) {
            const key = keys[i];
            if (!(key in current)) {
                current[key] = {};
            }
            current = current[key];
        }
        
        current[keys[keys.length - 1]] = value;
    }
    
    async function openMediaLibrary(targetField) {
        currentImageTarget = targetField;
        const modal = document.getElementById('mediaModal');
        const mediaGrid = document.getElementById('mediaGrid');
        
        openModal(modal);
        
        try {
            mediaGrid.innerHTML = '<div class="loading">加载中...</div>';
            
            const response = await fetch('/admin/api/media?type=image');
            const result = await response.json();
            
            if (result.success) {
                renderMediaGrid(result.files);
            } else {
                mediaGrid.innerHTML = '<div class="error">加载失败</div>';
            }
        } catch (error) {
            mediaGrid.innerHTML = '<div class="error">加载失败</div>';
            console.error('加载媒体库失败:', error);
        }
    }
    
    function renderMediaGrid(files) {
        const mediaGrid = document.getElementById('mediaGrid');
        
        if (files.length === 0) {
            mediaGrid.innerHTML = '<div class="empty">暂无图片</div>';
            return;
        }
        
        mediaGrid.innerHTML = files.map(file => `
            <div class="media-item" data-url="${file.url}" onclick="selectMediaItem(this)">
                <img src="${file.url}" alt="${file.name}">
                <div class="media-name">${file.name}</div>
            </div>
        `).join('');
    }
    
    function selectMediaItem(item) {
        // 移除之前的选择
        document.querySelectorAll('.media-item.selected').forEach(el => {
            el.classList.remove('selected');
        });
        
        // 选择当前项
        item.classList.add('selected');
        selectedImage = item.dataset.url;
        
        // 启用选择按钮
        document.querySelector('[data-action="select"]').disabled = false;
    }
    
    function selectImage() {
        if (selectedImage && currentImageTarget) {
            const targetInput = document.getElementById(currentImageTarget);
            if (targetInput) {
                targetInput.value = selectedImage;
                updateImagePreview(currentImageTarget, selectedImage);
            }
        }
        
        closeModal(document.getElementById('mediaModal'));
        selectedImage = null;
        currentImageTarget = null;
    }
    
    function updateImagePreview(targetField, imageUrl) {
        let previewContainer;
        
        switch (targetField) {
            case 'siteLogo':
                previewContainer = document.getElementById('logoPreview');
                previewContainer.innerHTML = `<img src="${imageUrl}" alt="Logo" class="preview-image">`;
                break;
            case 'authorAvatar':
                previewContainer = document.getElementById('avatarPreview');
                previewContainer.innerHTML = `<img src="${imageUrl}" alt="Avatar" class="preview-avatar">`;
                break;
        }
    }
    
    function openModal(modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal(modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
        
        // 重置状态
        selectedImage = null;
        currentImageTarget = null;
        document.querySelector('[data-action="select"]').disabled = true;
        document.querySelectorAll('.media-item.selected').forEach(el => {
            el.classList.remove('selected');
        });
    }
    
    // 全局函数
    window.selectMediaItem = selectMediaItem;
});
</script>